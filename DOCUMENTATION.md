# Запуск проекта

## 1. Клонирование репозитория

Перейти в рабочу директорию и выполнить команду:

> git clone https://github.com/YaroslavIonin/vk_friends.git

И перейти в папку проекта 

> cd vk_friends/

## 2. Работа с docker compose

### 1) Создадим контейнер
> sudo docker compose build
### 2) Применим миграции
> docker compose run web api_friends/manage.py makemigrations api

> docker compose run web api_friends/manage.py migrate
### 3) Запустим
> docker compose up

# Работа с API

### 1. Начало
##### Откроем в браузере http://127.0.0.1:8000/swagger/

![img.png](images/img3.png)

Видим интерфейс Swagger, в котором и будем работать

### 2. Регистрация пользователей
##### Регистрация пользователей доступна по адресу /api/register
![img.png](images/img1.png)

Зарегистрируем двух пользователей: User1 и User2

![img.png](images/img.png)
![img_2.png](images/img_2.png)

![img.png](images/img2.png)
![img_1.png](images/img_1.png)

### 3. Просмотр друзей
#### Просмотр друзей доступен по адресу /api/friends/
![img_3.png](images/img_3.png)

### 4. Отправление заявки в друзья
#### Отправление заявки в друзья доступно по адресу /api/bids/
![img_4.png](images/img_4.png)

Отправим заявку в друзья второму юзеру от первого
![img_5.png](images/img_5.png)

В ответе получаем объект созданной заявки со статусом 0 == Отправленная заявка
![img_6.png](images/img_6.png)

### 5. Просмотр исходящих/входящих заявок
#### Просмотр исходящих/входящих заявок доступен по адресу /api/bids/
![img_7.png](images/img_7.png)

Проверим исходящие заявки у первого юзера

![img_8.png](images/img_8.png)

Получим список исходящих заявок первого с только что отправленной заявкой

![img_9.png](images/img_9.png)

Проверив список входящих у первого, получим пустой список

![img_10.png](images/img_10.png)

Проверим входящие заявки у второго юзера
Получим список входящих заявок втрого с только что отправленной заявкой от первого

![img_11.png](images/img_11.png)

Проверив список исходщих у второго, получим пустой список

![img_12.png](images/img_12.png)

### 6. Принятие/отклонение заявки
#### Принятие/отклонение заявки доступно по адресу /api/bids/{id}
![img_13.png](images/img_13.png)

Допустим, что второй отклоняет заявку в друзья (status_do == 0, id == 1)

![img_14.png](images/img_14.png)

Исходящие и входящие заявки обоих юзеров не изменятся, 
изменится только статус заявки на 2 == Отклоненная заявка

Допустим, что второй принимает заявку в друзья (status_do == 1, id == 1)

![img_15.png](images/img_15.png)

Заявка исчезнет у первого из исходящих, у второго из входящих
Юзеры станут друзьями

### 7. Список друзей и статус дружбы
#### Список друзей доступен по адресу /api/friends/
![img_16.png](images/img_16.png)

Убедимся, что друзья появились у пользователей

У первого
![img_17.png](images/img_17.png)

У второго
![img_18.png](images/img_18.png)

#### Cтатус дружбы доступен по адресу /api/bids/check_status/
![img_19.png](images/img_19.png)

Проверим статус дружбы пользователей

![img_20.png](images/img_20.png)

### Удаление пользователя из друзей
#### Удаление пользователя из друзей доступно по адресу /api/friends/{id}
![img_21.png](images/img_21.png)

Допустим, 2 юзер удаляет первого

![img_22.png](images/img_22.png)

Проверяем статус дружбы

Для первого со вторым
![img_23.png](images/img_23.png)

Для второго с первым
![img_24.png](images/img_24.png)

Так же в исходящих/входящих появится созданная заявка от первого второму

![img_25.png](images/img_25.png)

Снова принимает заявку и предположим, что первый удаляет второго

![img_26.png](images/img_26.png)

Проверяем статус дружбы

Для первого со вторым
![img_27.png](images/img_27.png)

Для второго с первым
![img_28.png](images/img_28.png)

Так же в исходящих/входящих появится созданная заявка от второго первому (второй как будто попадает в подписчики)

![img_29.png](images/img_29.png)


### 8. Случай перекрёстных заявок

В данный момент у нас только одно заявка от второго первому
Пусть первый тоже отправит заявку второму

![img_30.png](images/img_30.png)

Получаем объект созданной заявки сразу со статусом 1 == Принятая заявка

Проверив исходящие/входящие заявки обоих юзеров, получис пустые списки, 
потому что обе созданные заявки принялись, и пользователи стали друзьями

Проверим статус дружбы

![img_31.png](images/img_31.png)

### 9. Удаление из друзей при перекрёстных заявках

На данный момент в системе две принятые заявки от первого второму и от второго первому

Допустим первый удаляет второго

![img_32.png](images/img_32.png)

В базе данных остаётся только заявка от второго первому с изменёным статусом на 0 == Отправленная заявка,
а пользователя удалятся друг друга из друзей

Проверим это в исходящих\входящих заявках

У второго появилась исходящая
![img_33.png](images/img_33.png)

У первого появилась входящая
![img_34.png](images/img_34.png)


В точности до наоборот будет, если второй удалит первого